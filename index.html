<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GLB Viewer: Day & Night</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; }
    #upload, #toggleBtn {
      position: fixed; top: 10px; left: 10px;
      z-index: 10; background: #fff; padding: 10px;
      border: none; cursor: pointer; border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    #toggleBtn { left: auto; right: 10px; }
    canvas { display: block; }
  </style>
</head>
<body>

<input type="file" id="upload" accept=".glb" />
<button id="toggleBtn">Switch to Night</button>
<script type="module">
  import * as THREE from "https://cdn.skypack.dev/three@0.150.1";
  import { OrbitControls } from "https://cdn.skypack.dev/three@0.150.1/examples/jsm/controls/OrbitControls";
  import { GLTFLoader } from "https://cdn.skypack.dev/three@0.150.1/examples/jsm/loaders/GLTFLoader";

  let scene, camera, renderer, loader, controls;
  let currentModel, isDay = true;

  init();

  function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 1.5, 3);

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    const light = new THREE.AmbientLight(0xffffff, 1);
    scene.add(light);

    loader = new GLTFLoader();

    animate();

    // Upload button
    document.getElementById('upload').addEventListener('change', e => {
      const file = e.target.files[0];
      if (file && file.name.endsWith('.glb')) {
        const url = URL.createObjectURL(file);
        loadModel(url);
      } else {
        alert("Please upload a valid .glb file.");
      }
    });

    // Toggle Button
    document.getElementById('toggleBtn').addEventListener('click', () => {
      isDay = !isDay;
      const url = isDay ? 'assets/day/scene_day.glb' : 'assets/night/scene_night.glb';
      document.getElementById('toggleBtn').textContent = isDay ? 'Switch to Night' : 'Switch to Day';
      loadModel(url);
    });

    // Drag-and-drop
    window.addEventListener("dragover", e => e.preventDefault());
    window.addEventListener("drop", e => {
      e.preventDefault();
      const file = e.dataTransfer.files[0];
      if (file && file.name.endsWith('.glb')) {
        const url = URL.createObjectURL(file);
        loadModel(url);
      } else {
        alert("Drop a valid .glb file.");
      }
    });

    // Load initial day model
    loadModel("assets/day/scene_day.glb");
  }

  function loadModel(url) {
    if (currentModel) {
      scene.remove(currentModel);
      currentModel.traverse(obj => {
        if (obj.geometry) obj.geometry.dispose();
        if (obj.material) {
          if (Array.isArray(obj.material)) obj.material.forEach(m => m.dispose());
          else obj.material.dispose();
        }
      });
    }

    loader.load(url, gltf => {
      currentModel = gltf.scene;
      scene.add(currentModel);
    }, undefined, err => {
      console.error("Error loading model:", err);
      alert("Failed to load model.");
    });
  }

  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  }

  window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>
